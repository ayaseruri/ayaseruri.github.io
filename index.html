<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="生活,Android,编程,摄影" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="一个少年，想要拥抱这宇宙的闪耀并创造奇迹。">
<meta property="og:type" content="website">
<meta property="og:title" content="Ayaseruri">
<meta property="og:url" content="http://ayaseruri.net/index.html">
<meta property="og:site_name" content="Ayaseruri">
<meta property="og:description" content="一个少年，想要拥抱这宇宙的闪耀并创造奇迹。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ayaseruri">
<meta name="twitter:description" content="一个少年，想要拥抱这宇宙的闪耀并创造奇迹。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Ayaseruri'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ayaseruri.net/"/>





  <title>Ayaseruri</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ayaseruri</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一个简单的少年</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-photo">
          <a href="/photo/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-camera"></i> <br />
            
            摄影
          </a>
        </li>
      
        
        <li class="menu-item menu-item-create">
          <a href="/create/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heart"></i> <br />
            
            作品
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/JK-制服摄影の思路整理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/JK-制服摄影の思路整理/" itemprop="url">JK 制服摄影の思路整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T09:06:11+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>好吧，横空出现这样的一篇文章我也觉得很意外，因为最近可能又要拿起相机，所以从 JK 制服摄影说开去，稍微整理一下少女摄影思路。（个人思路，不喜忍着，全篇无图）</p>
<ul>
<li>#####颜即正义，但不是全部<br>说到拍妹子照大部分人第一反应就是说妹子漂亮就可以了。的确一个颜值炸裂的妹子可以让你在拍摄和后期过程中省事不少，但是这不是全部，因为只是单纯妹子好看的图片不会让人产生画外联想和共鸣。曾今看了很多美女的照片，可是拿走照片，脑海中不会有任何印象，就其原因就是照片没有思路，没有主题，我们看到的仅仅是一个颜值颇高的妹子而已。传说中的糖水片大部分就属于这种范畴。<br>那么问题来了，人像照片重要的应该是什么呢？举例一组正面例子的图片：<br><a href="http://i.mouto.org/#19brjv6" target="_blank" rel="external">星空水手服</a><br>这组照片中，妹子的情感和满屏幕溢出的阳光相得益彰，至少我看了这组照片以后好多年还记得这组照片，为什么？因为你隔着屏幕就能感受到妹子的情感。</li>
<li>#####对没错，是情感！<br>对的，人像中最重要的一层。照片的情感是摄影师和妹子共同参与表达的，是一组照片的灵魂。在希望出正片的拍摄过程中（随意拍拍不在讨论之内）首先摄影师自己要有一个整体的思路，你的整个思考过程可以是：<br>“呀，眼前这个妹子真可爱！那么哪里可爱呢？我觉得是眼睛，我觉得她笑的时候眼睛在发光，让人有一种想要守护的感觉。”<br>这就是一个思路，是不是很简单，那么接下来的拍摄的若干照片就可以按照上面思路进行，抓住妹子的眼睛和笑容，既然是希望守护的感觉，那么书本遮住下巴，眼睛特写，单手遮阳这样的构图思路也就自然而然出来了。</li>
<li>#####学会表达情感<br>有了主题和情感，那么我们接下来所做的一切就是要表达这种主题和情感。如何表达呢？<ul>
<li>######色彩<br>色彩有很强的主观性，我的理解就是他们有风格但没有参数。举个例子：日系胶片色是我很喜欢的一种风格，我知道的是它们都有大量留白，白色偏青蓝，绿色偏青绿，但是参数是什么这个要看当时我调照片的心情了。在一个风格下会有很多组具体参数的搭配，这些需要你在不停的调色中去总结心中的感觉和眼前看到的色彩的感觉，具体来说就是：我心中希望表达的是 MUJI 风格照片的舒适，淡雅。这里的有一个思路就是”颜色要素”，那么我先把对比度调低 10% 然后我观察，眼前展现的照片是不是我要表达的感觉，不是那么我继续调节；</li>
<li>######对比<br>对比可以用在构图，色彩，光线等上，我觉得它是一个万用的原则。不要吝啬的使用对比，明暗，黑白，多少，远近太多太多都可拿来对比。再拍摄的时候心中总想着我能不能构造出一个对比，如果照片中有两处出色的对比使用那么这张照片一定就不会平淡。</li>
<li>######基本技能不可少<br>常用的构图方式，逆光拍摄方法等等这些东西不多赘述，这是基础。<br>上面就是忽然想起来的一些拍摄的总结，全文不想引用一些图片佐证，希望在拍摄正片的过程中给大家一些帮助。</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/Android-资源文件优化思考/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/Android-资源文件优化思考/" itemprop="url">Android 资源文件优化思考</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T09:05:18+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>关于 Android 图片资源目前我一共写了三篇文章：</p>
<p><a href="http://ayaseruri.net/index.php/archives/8/">Android AndResGuard 资源混淆 </a><br><a href="http://ayaseruri.net/index.php/archives/9/">一种全新的图片格式 WebP </a><br><a href="http://ayaseruri.net/index.php/archives/38/">Android 矢量图支持分析 </a></p>
<p>以上的文章从不同的角度对 Android 的图片资源进行了优化，也给我们提供了一种解决问题的思路，所以我想我们可以从 Android AndResGuard 源码入手，开发一个可以对 Apk 资源进行优化处理的工具，这个工具应该具有如下功能：</p>
<ul>
<li>[] 分析Apk，依据策略对图片资源情况进行直观展示</li>
<li>[] 依据策略（例如：图片大小，图片颜色数量，图片格式，是否有透明度通道等），对异常图片进行警告（提示针对警告图片进行特殊优化）</li>
<li>[] 依据策略（例如：图片大小，图片颜色数量，图片格式，是否有透明度通道等），优化图片格式（统一优化策略，避免多人开发中可能的问题；避免 UE 的重复工作，UE只需要正常输出 png 即可；具体掌握 Apk 中资源分布情况；及时应用新的压缩格式）</li>
<li>[X] 去除未使用资源</li>
<li>[X] 对资源进行混淆，压缩</li>
<li>[X] 兼容 Tinker</li>
</ul>
<p>其中标记 [X] Android AndResGuard 已经帮助我们做好了，而前面文章介绍过 Android AndResGuard 在运行的过程中会对图片资源进行重新命名，经过阅读 AndResGuard 源码可知，其关键方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">FileOperation.copyFileUsingStream(resRawFile, resDestFile);</div></pre></td></tr></table></figure>
<p>所以我们可以在这个方法中做文章，从而完成前三点需求。从而统一解决 Apk 中资源文件的问题。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/Android-矢量图支持分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/Android-矢量图支持分析/" itemprop="url">Android 矢量图支持分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T09:04:27+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文参考 <a href="http://note.youdao.com/share/index.html?id=6ad509598519a93372b5ca489664fd8f&amp;type=note&amp;from=singlemessage#/" target="_blank" rel="external">浩哥原文</a>，作为补充说明和内容备份使用。</p>
<p>由于设备碎片化的原故， Android App 中图片资源的适配在实际的项目过程中非常的不方便，主要有以下几个问题：</p>
<ul>
<li>需要为多种分辨率准备图片，造成 App 包体积增大</li>
<li>UE 输出资源繁琐，RD 整理起来麻烦</li>
<li>针对某些特殊分辨率机型系统会对图片资源进行缩放，导致显示效果差异</li>
</ul>
<p>因此在 Android 5.0 之后，Google 加入了 vectordrawable（<a href="https://developer.android.com/reference/android/graphics/drawable/VectorDrawable.html" target="_blank" rel="external">官方文档</a>） 类来支持矢量图的操作。矢量图大家也不陌生，它具有以下优点：</p>
<ul>
<li>矢量图的大小需要占用比普通位图更小的空间</li>
<li>矢量图的缩放不会产生模糊的问题，即使放大了很多倍还是一样清晰</li>
<li>开发中 UE 只需要提供一张图，RD 也只需要管理一张图，更加的方便</li>
</ul>
<p>那么能不能完全用矢量图代替常规的 png、webp 图片作为我们 Android 开发的首选图片呢？我们从以下几个角度来看这个问题：</p>
<h4 id="1-兼容性"><a href="#1-兼容性" class="headerlink" title="1.兼容性"></a>1.兼容性</h4><p>首先网上并没有资料说明国内某些大厂在自家产品中广泛使用矢量图，Android studio 中按照如下策略执行：</p>
<ul>
<li><p>当 minSdkVersion 大于等于 Android 5.0 时，原生通过 vectordrawable 支持矢量图。具体使用方法是：、</p>
<ol>
<li>设计工具（PS、Sketch）导出 svg 矢量图 或者 这个网站可以在线将 png 图片转化成矢量图。不过在实际使用过程中我们发现，此工具在转化有很多色彩的图片的时候会出现问题。</li>
<li>讲上述文件转化为 vectordrawable（<a href="http://inloop.github.io/svg2android/" target="_blank" rel="external">在线转换地址</a>）的一个 xml 文件</li>
<li>将 xml 文件拷入 Android Studio 即可像正常 drawable 资源那样使用</li>
</ol>
</li>
<li><p>当 minSdkVersion 小于 Android 5.0 时<br>  <strong>方式1.</strong> gradle 默认编译的时候会把 VectorDrawable 生成相应的位图资源打包在 APP 里，如图：<br>  <img src="http://ww1.sinaimg.cn/mw690/a79b04ecgy1fdxvp5ebkej20ny0ron1i.jpg" width="350"></p>
<p>  我们发现系统已经帮我们生成了在不同分辨率下的对应图片，并且还有一个目录是专门针对 API 等级在21以上的提供的矢量图文件<br>  这样以来在低于21的机型上会自动使用生成的 png 图片，在高于21的机型上则使用矢量图文件<br>  但是在非常多的项目中其实并不需要如此多的分辨率图片，其实这个也是可以配置的只需要在 gradle 中进行如下配置即可：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">defaultConfig &#123;</div><div class="line">	vectorDrawables.generatedDensities = ['hdpi','xxhdpi']	// 只剩成 hdpi 和 xxhdpi 的图</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <strong>方式2.</strong> 不自动生成位图, 在 Android Support Library 23.2 中主要增加了对 VectorDrawable 与AnimateVectorDrawable 的支持。VectorDrawable 可以被兼容到 Android2.1, AnimateVectorDrawable 可以被兼容到 Android3.0。 在 gradle 中进行如下配置:</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">defaultConfig &#123;</div><div class="line">	vectorDrawables.useSupportLibrary = true  </div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>  在引用 vectordrawable 资源时使用  app:srcCompat 取代 android:src , 代码中使用setImageResource()指定资源 id 时，无需更改代码，若你还想将此 Vectordrawable 资源用作 View 的背景 , 遗憾的是这里没有一个类似的 app:backgroundCompat 方法 , 你只能通过代码来设置:</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Resources resources = context.getResources(Resources, <span class="keyword">int</span>, Theme);</div><div class="line">Theme theme = context.getTheme();</div><div class="line">Drawable drawable = VectorDrawableCompat.create(resources, R.drawable.vector_drawable, theme);</div><div class="line">view.setBackground(drawable);</div></pre></td></tr></table></figure>
<p>  在非 src 属性的地方使用矢量图时，需要将矢量图用 drawable 容器(如StateListDrawable, InsetDrawable, LayerDrawable, LevelListDrawable, 和RotateDrawable)包裹起来，并且添加如下代码。否则会在低版本的情况下报错。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span>&#123;</div><div class="line">	AppCompatDelegate.setCompatVectorFromResourcesEnabled(<span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-性能"><a href="#2-性能" class="headerlink" title="2.性能"></a>2.性能</h4><p>首先引用 Google 官方文档写到：</p>
<blockquote>
<p>A vector drawable is appropriate for simple icons. The material icons provide good examples of the types of images that work well as vector drawables in an app. In contrast, many app launch icons do have many details, so they work better as raster images.</p>
</blockquote>
<pre><code>大致意思是 vectorDrawable 只适合于像 material icons 这样的简单图片, 并不适合细节过于复杂的图片.
</code></pre><p>同样的 <a href="http://note.youdao.com/share/index.html?id=6ad509598519a93372b5ca489664fd8f&amp;type=note&amp;from=singlemessage#/" target="_blank" rel="external">浩哥原文</a> 中也对展示简单的图片和复杂图片所用时间进行了简单测试，这里引用结论是：</p>
<pre><code>&gt;当图片是以简单图形为主的时候适合用矢量图来实现，性能消耗不会相差非常多（实验数据相差50ms左右），但是如果变得复杂的时候矢量图的解析时间会大大加长（实验数据3000ms左右）、

这里我也进行了测试，测试环境是：一加手机2 氧OS(基于 Android 6.0.1 )
测试代码放到了 [Github ResTest](https://github.com/ayaseruri/ResTest)
测试程序截图：
&lt;img src=&quot;http://ww1.sinaimg.cn/large/a79b04ecgy1fee63hffhnj20u01hcdi3.jpg&quot; width=350/&gt;
测试方法是：将同一张图片 PNG 图片用工具分别转化成为 WebP 、SVG 然后使用如下代码进行加载：
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">long</span> startTime = System.currentTimeMillis();</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i ++) &#123;</div><div class="line">		mImgView.setImageDrawable(getResources().getDrawable(R.drawable.img));</div><div class="line">   &#125;</div><div class="line"><span class="keyword">long</span> endTime = System.currentTimeMillis() - startTime;</div></pre></td></tr></table></figure>

矢量图通过兼容的方式加载：
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Drawable drawable = VectorDrawableCompat.create(getResources(), R.drawable.loading_svg, getTheme());</div><div class="line">mImgView.setImageDrawable(drawable);</div></pre></td></tr></table></figure>

每次均后台完全杀死 App 重启 App，同时观察这个过程中内存使用情况，首先使用的较为复杂的测试图片如下：
![](http://ww1.sinaimg.cn/mw690/a79b04ecgy1febrq56b90j205905mwed.jpg)
测试结果如下：

格式 | 内存 | 时间(ms)
--- | ---
PNG | 总内存(Allocated + free)不变，空闲内存减少 0.9mb | 14
WebP | 总内存(Allocated + free)不变，空闲内存减少 0.9mb | 30
SVG | 总内存(Allocated + free)不变，空闲内存减少 2.9mb | 374

第二张测试图片如下：
![](http://ww1.sinaimg.cn/large/a79b04ecgy1fecstryf3tj200x0180h8.jpg)
测试结果如下:

格式 | 内存 | 时间(ms)
--- | ---
PNG | 总内存(Allocated + free)不变，空闲内存减少 0.65mb | 6
WebP | 总内存(Allocated + free)不变，空闲内存减少 0.63mb | 7
SVG | 总内存(Allocated + free)不变，空闲内存减少 0.7mb | 10
</code></pre><h4 id="3-结论"><a href="#3-结论" class="headerlink" title="3.结论"></a>3.结论</h4><ul>
<li>目前 Android 对 SVG 的略显繁琐，但是再简单图片的支持上还是可以使用。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/没事抖个机灵-RD-和-PM-的日常/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/没事抖个机灵-RD-和-PM-的日常/" itemprop="url">没事抖个机灵 RD 和 PM 的日常</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T09:02:03+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>小 RD 一到办公室，所有 PM 便都看着他笑，有的叫道，“ RD 儿，你又有新 Bug了！”<br>他不回答，对 PM 说：“给我一份详设，需求要写清楚些。”便走到工位坐下和熟练的打开 IDE 。<br>PM 们又故意的高声嚷道，“你的数据一定又有错误，有大 Bug 了！”<br>小 RD 睁大眼睛说，“你们怎么这样凭空污人清白……”<br>“什么清白？我前天亲自试用过，上面显示[测试数据]，数据上还有很多问题。”<br>小 RD 便涨红了脸，睁大了带着轮胎般眼袋的眼睛，争辩道，“测试数据不能算……算 Bug ！……明明还在开发，能算 Bug 么？”接连便是难懂的话，什么“需求一直在改”，什么“不要黑我们程序员”之类，引得众人都哄笑起来，店内外充满了快活的空气。</p>
<p>小 RD 看着自己的测试手机，似乎完成了几段功能，涨红的脸色渐渐复了原， PM 便问道:“ RD 儿，你当真喜欢编程？”小 RD 看着问他的人，显出不屑置辩的神气。<br>他们便接着说道:“那你怎的连这么简单的需求都不能完成呢？”<br>小 RD 立刻显出一副颓唐不安模样，脸上笼了一层灰色，嘴里说些话，什么出排序的算法有七种常用之类,资源需要及时释放，引得众人继续哄笑起来。</p>
<p>有一天，大约是中秋前的两三天，PM A 正在慢慢的Review，打开电脑，忽然说，“ RD 儿长久没有来了。还有十几个 Bug 呢！”<br>我才也觉得他的确长久没有来了。<br>PM B 说道，“他怎么会来？……他常年加班差点没了命。”<br>PM A 说，“哦！”<br>“他总仍旧是写代码。这一回，是自己发昏，竟真不听 PM 的。代码这的东西，能不听 PM 的么？”<br>“后来怎么样？”<br>“怎么样？先是发现 Bug，看详设，一检查还发现误了期限，后来实在写不完了。”<br>“后来呢？”<br>“后来就没音讯了。”<br>“没声音了怎样呢？”<br>“怎样？……谁晓得？许是又跑到别的公司去了。”<br>PM A 也不再问，仍然慢慢的算他的需求。</p>
<p>中秋之后，秋风是一天凉比一天，看看将近初冬，我整天的靠着火，也须穿上棉袄抱着暖气不撒手了。<br>一天的下半天，没有一个人吱声，沉闷的办公室，我正窝在工位着刷微博。忽然间听得一个声音，“给我一份详设，需求要写清楚些。”这声音虽然极低，却很耳熟。我用眼角一看，那小 RD 便在工位对侧站着，拉拢着脑袋。<br>他脸上黄而且瘦，已经不成样子，穿一件露背毛衣，怂着肩，拿着一个 Mac，用力的用手端着。见了我，又说道，“给我一份详设，需求要写清楚些。”QA 也伸出头去，一面说，“ RD 儿么？你还有好几个 Bug 呢！”小 RD 很颓唐的仰面答道，“这……下回改正吧。这一回先完成新版本功能，工期很紧张，要求不能拖沓。” PM 仍然同平常一样，笑着对他说，“ RD 儿，又要有大 Bug 了！”但它这回却不十分分辩，单说了一句“不要取笑！”<br>“取笑？要是没有 Bug，怎么会拖延需求？”<br>小 RD 低声说道，“开开发，测试，测……”他的眼色，很像恳求 PM，不要再提。<br>此时已经聚集了几个 PM ， PM 和 QA 都笑了。<br>自此以后，又长久没有看见小 RD 。到了年关， PM 打开电脑说，“ RD 儿还有好几个 Bug 呢！”到第二年的端午，又说“ RD 儿还有好几个 Bug 呢!随便改改也成啊。”到中秋可是没有说，再到年关也没有看见他。</p>
<p>我到现在终于没有见。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/Android-注解支持-Android-Support-Annotations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/Android-注解支持-Android-Support-Annotations/" itemprop="url">Android 注解支持 (Android Support Annotations)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T09:01:22+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><h3 id="什么是注解支持-Support-Annotations"><a href="#什么是注解支持-Support-Annotations" class="headerlink" title="什么是注解支持 (Support Annotations)"></a>什么是注解支持 (Support Annotations)</h3>做 Android 开发的应该对 Android Support Library 并不陌生。 Android support library 从19.1版本开始引入了一个新的代码注解库。具体引入方法是:<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    compile 'com.android.support:support-annotations:19.1.0'</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>当然，如果你正在使用appcompat库，那么你已经可以使用这些注解了，因为appcomat它自己也依赖它。</p>
<ul>
<li><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3>Android Studio 已经基于这些注解校验了你的代码并且标注其中潜在的问题，Android Studio 会依据注解进行实时提示。 Support Annotations 可以修饰代码，帮助你或者别人发现bug，节约多人开发的沟通成本。</li>
<li><h3 id="常用-Support-Annotations"><a href="#常用-Support-Annotations" class="headerlink" title="常用 Support Annotations"></a>常用 Support Annotations</h3><ul>
<li><h4 id="NullXX-空指针检测"><a href="#NullXX-空指针检测" class="headerlink" title="NullXX 空指针检测"></a>NullXX 空指针检测</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Nullable</span> <span class="comment">//给定的参数或者返回值可以为null。</span></div><div class="line"><span class="meta">@NonNull</span>  <span class="comment">//给定的参数或者返回值不能为null。</span></div></pre></td></tr></table></figure>
<p>例如在 Android 源码 AppCompatActivity 类里面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">	……</div><div class="line">&#125;</div><div class="line">……</div><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onPostCreate(savedInstanceState);</div><div class="line">       getDelegate().onPostCreate(savedInstanceState);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>需要注意的是，此注解使用需要注意时机，在对人们对判空达成『共识』的地方我们可以适当省略，以免 IDE 大量提示造成不必要的困扰，例如 Android 源码中这一段就省略了返回值的 @Nullable ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="meta">@Nullable</span>(被省略)</div><div class="line">   <span class="function"><span class="keyword">public</span> View <span class="title">findViewById</span><span class="params">(@IdRes <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> getDelegate().findViewById(id);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>同样的，在合适的地方使用此类注释可以大量的减少不必要的类如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != getSomething()) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>的判空，想想看自己以前写过的代码，是不是有很多地方可以加上此类注释。</p>
</li>
<li><h4 id="XXXRes-资源类"><a href="#XXXRes-资源类" class="headerlink" title="XXXRes 资源类"></a>XXXRes 资源类</h4><p>因为 Android 的资源类型通常都是使用资源 ID 进行传递的，所以有时候我们会产生疑惑，例如下面这段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(<span class="keyword">int</span> color)</span></span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在使用过程中，上段代码应该 <code>setColor(R.color.red)</code> 还是应该 <code>setColor(Color.RED)</code> 呢？<br>与资源相关的注释有： <code>@StringRes, @DrawableRes, @ColorRes, @ColorInt, @InterpolatorRes</code> 顾名思义，我们可以直接把他们用到相应的地方。例如上段代码，如果我们希望用户这样使用 <code>setColor(R.color.red)</code> ,那么我们就可以这样写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(@ColorRes <span class="keyword">int</span> color)</span></span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果是 <code>setColor(Color.RED)</code>,可以这样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(@ColorInt <span class="keyword">int</span> color)</span></span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><h4 id="IntDef-StringDef-类型定义注解"><a href="#IntDef-StringDef-类型定义注解" class="headerlink" title="IntDef/StringDef: 类型定义注解"></a>IntDef/StringDef: 类型定义注解</h4><p>当我们的返回值或者参数指定了可用的 int 或者 string 常量值时我们可以使用上述注解，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToastUtils</span> </span>&#123;</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOAST_ALERT = <span class="number">0</span>;</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOAST_INFO = <span class="number">1</span>;</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOAST_CONFIRM = <span class="number">2</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showTost</span><span class="params">(@ToastType <span class="keyword">int</span> type)</span></span>&#123;</div><div class="line">&#125;</div><div class="line"><span class="meta">@ToastType</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getToastType</span><span class="params">()</span></span>&#123;</div><div class="line">&#125;</div><div class="line"><span class="meta">@IntDef</span>(&#123;TOAST_INFO, TOAST_ALERT, TOAST_CONFIRM&#125;)</div><div class="line">   <span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</div><div class="line">   <span class="keyword">public</span> <span class="meta">@interface</span> ToastType&#123;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于上述情况，如果我们需要使用位运算( |, &amp;, ^ 等)，可以这样定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@IntDef</span>(flag=<span class="keyword">true</span>, value=&#123;TOAST_INFO, TOAST_ALERT, TOAST_CONFIRM&#125;)</div><div class="line">   <span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</div><div class="line">   <span class="keyword">public</span> <span class="meta">@interface</span> ToastType&#123;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>@Retention 表示当前 @IntDef 的保留策略，可以使用如下几个值：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RetentionPolicy.SOURCE  //只保留源码中，编译时删除</div><div class="line">RetentionPolicy.CLASS   //编译时被保留,在class文件中存在,但JVM将会忽略</div><div class="line">RetentionPolicy.RUNTIME //将被JVM保留,所以他们能在运行时被JVM或其他使用反射机制的代码所读取和使用</div></pre></td></tr></table></figure>
<p>绝大部分时候我们只需要使用 <code>RetentionPolicy.SOURCE</code> 仅作为 IDE 提示的依据。</p>
</li>
<li><h4 id="XXXThread-线程类"><a href="#XXXThread-线程类" class="headerlink" title="XXXThread 线程类"></a>XXXThread 线程类</h4><p>这个很有用，很多时候我们希望自己的方法在指定类型线程中运行，例如进行 UI 操作的时候，我们希望操作能在主线程中进行。需要注意的是，在实际使用过程中 IDE 并不能智能的检测运行时代码块所处的线程，一般来说当方法标记为 <code>@WorkerThread</code> 时，在其代码块儿中我们调用了被标记为 <code>@UiThread</code>的方法，此时 IDE 会明确提示问题，所以推测 IDE 应该是依据标记来判断代码块的运行线程，只有当标记冲突的时候才会进行提示。<br><code>@XXXThread</code> 被标注的方法应该只能在 XXX 线程中被调用。如果它被用来标记类，那么表示此类中所有的方法只能在 XXX 线程中调用，相关的注解有以下几个：<br><code>@UiThread，@MainThread，@WorkerThread，@BinderThread</code><br>例如 Android 源码中对 View 类的声明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">	<span class="meta">@UiThread</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span> <span class="keyword">implements</span> <span class="title">Drawable</span>.<span class="title">Callback</span>, <span class="title">KeyEvent</span>.<span class="title">Callback</span>,<span class="title">AccessibilityEventSource</span> </span>&#123;</div><div class="line">		&#125;</div></pre></td></tr></table></figure>
<p><code>@MainThread</code> 和 <code>@UiThread</code> 的定义完全一样，但是由于 <code>MainThread</code> 本质上是一个 <code>UiThread</code>，而大部分情况下 <code>UiThread</code> 又是一个 <code>MainThread</code> ，所以一般来说我们把和生命周期相关的用 <code>@MainThread</code>  标注，和 <code>View</code> 相关的用 <code>@UiThread</code> 标注。</p>
</li>
<li><h4 id="数值约束"><a href="#数值约束" class="headerlink" title="数值约束"></a>数值约束</h4><p>在有的 API 中 透明度（Alpha）的取值范围是 0~255 ，而有的是 0~1。为了解决这个问题我们可以使用类似 <code>@Size, @IntRange, @FloatRange</code>的注解，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAlpha</span><span class="params">(@IntRange(from=<span class="number">0</span>,to=<span class="number">255</span>)</span> <span class="keyword">int</span> alpha) </span>&#123; … &#125;	<span class="comment">// 表明Alpha 大于等于0，小于等于255。</span></div></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAlpha</span><span class="params">(@FloatRange(from=<span class="number">0.0</span>,to=<span class="number">1.0</span>)</span> <span class="keyword">int</span> alpha) </span>&#123; … &#125;</div></pre></td></tr></table></figure>
<p><code>@Size</code> 我们会这样使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">集合不能为空: <span class="meta">@Size</span>(min=<span class="number">1</span>)</div><div class="line">字符串最大只能有<span class="number">23</span>个字符: <span class="meta">@Size</span>(max=<span class="number">23</span>)</div><div class="line">数组只能有<span class="number">2</span>个元素: <span class="meta">@Size</span>(<span class="number">2</span>)</div><div class="line">数组的大小必须是<span class="number">2</span>的倍数 (例如图形API中获取位置的x/y坐标数组: <span class="meta">@Size</span>(multiple=<span class="number">2</span>)</div></pre></td></tr></table></figure>
</li>
<li><h4 id="RequiresPermission-权限注解"><a href="#RequiresPermission-权限注解" class="headerlink" title="RequiresPermission 权限注解"></a>RequiresPermission 权限注解</h4><p>我在使用某些例如写入文件，定位库的时候有时候会感到疑惑：库方法本身是否已经对权限做了处理呢。这里 <code>RequiresPermission</code> 就可以有效解决这个问题。<br>如果你的方法的调用需要调用者有特定的权限，你可以使用 <code>@RequiresPermission</code> 注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequiresPermission</span>(Manifest.permission.SET_WALLPAPER)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setWallpaper</span><span class="params">(Bitmap bitmap)</span> <span class="keyword">throws</span> IOException</span>;</div></pre></td></tr></table></figure>
<p>如果你至少需要权限集合中的一个，你可以使用anyOf属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequiresPermission</span>(anyOf = &#123;</div><div class="line">   Manifest.permission.ACCESS_COARSE_LOCATION,</div><div class="line">   Manifest.permission.ACCESS_FINE_LOCATION&#125;)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Location <span class="title">getLastKnownLocation</span><span class="params">(String provider)</span></span>;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>如果你同时需要多个权限，你可以用allOf属性：<br>    <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequiresPermission</span>(allOf = &#123;</div><div class="line">   Manifest.permission.READ_HISTORY_BOOKMARKS,</div><div class="line"> 	Manifest.permission.WRITE_HISTORY_BOOKMARKS&#125;)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">updateVisitedHistory</span><span class="params">(ContentResolver cr, String url, <span class="keyword">boolean</span> real)</span> </span>&#123;</div></pre></td></tr></table></figure></p>
<pre><code>对于intents的权限，可以直接在定义的intent常量字符串字段上标注权限需求(它们通常都已经被`@SdkConstant` 注解标注过了):
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequiresPermission</span>(android.Manifest.permission.BLUETOOTH)</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTION_REQUEST_DISCOVERABLE =    <span class="string">"android.bluetooth.adapter.action.REQUEST_DISCOVERABLE"</span>;</div></pre></td></tr></table></figure>

对于content providers的权限，你可能需要单独的标注读和写的权限访问，所以可以用@Read或者@Write标注每一个权限需求：
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequiresPermission</span>.Read(<span class="meta">@RequiresPermission</span>(READ_HISTORY_BOOKMARKS))</div><div class="line"><span class="meta">@RequiresPermission</span>.Write(<span class="meta">@RequiresPermission</span>(WRITE_HISTORY_BOOKMARKS))</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Uri BOOKMARKS_URI = Uri.parse(<span class="string">"content://browser/bookmarks"</span>);</div></pre></td></tr></table></figure>

- #### 方法重写 CallSuper
如果你的API允许使用者重写你的方法，但是呢，你又需要你自己的方法(父方法)在重写的时候也被调用，这个时候需要用到 `@CallSuper`，例如：
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@CallSuper</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

- #### 检查返回值 CheckResult
我们有时候回忽略一些方法的返回值，比如 `        File#mkdir()` 如果你希望方法使用者不要忽略了方法的返回值，就可以用到 `@CheckResult`
- #### Keep 防止混淆
`@Keep` 可以用在方法，变量和类上，用于标记对应的代码块不被混淆，例如：
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//防止混淆类</span></div><div class="line"><span class="meta">@Keep</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;&#125;</div><div class="line"><span class="comment">//防止混淆变量</span></div><div class="line"><span class="meta">@Keep</span></div><div class="line"><span class="keyword">public</span> String name;</div><div class="line"><span class="comment">//防止混淆方法</span></div><div class="line"><span class="meta">@Keep</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>&#123;&#125;</div></pre></td></tr></table></figure>

但是有时候你会发现 `@Keep` 注释并没有生效，原因是 Gradle 插件的支持问题（目前应该已经被支持），这个时候我们可以手动在 `progurad-rules.pro` 加入如下代码手动开启：
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">	#手动启用support keep注解</div><div class="line">	#http://tools.android.com/tech-docs/support-    annotations</div><div class="line">	-dontskipnonpubliclibraryclassmembers</div><div class="line">	-printconfiguration</div><div class="line">	-keep,allowobfuscation @interface         android.support.annotation.Keep</div><div class="line">	-keep @android.support.annotation.Keep class *</div><div class="line">	-keepclassmembers class * &#123;</div><div class="line">    @android.support.annotation.Keep *;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/你可能遇到了假的单例模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/你可能遇到了假的单例模式/" itemprop="url">你可能遇到了假的单例模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T09:00:35+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>做开发的人几乎都写过单例模式，很多人会觉得单例模式很简单，所以也没有深入进行思考。记得以前我在创业公司，前来面试的人90%的单例模式都是假的，所以今天我们就来深入谈谈单例模式的写法。</p>
<ul>
<li><h3 id="典型错误"><a href="#典型错误" class="headerlink" title="典型错误"></a>典型错误</h3><p>  提到单例模式，大部分人可能马上就会想到如下代码：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> Scheduler sChedulers;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Scheduler <span class="title">getSchedulers</span><span class="params">()</span> </span>&#123;</div><div class="line">	  <span class="keyword">if</span>(<span class="keyword">null</span> == sChedulers)&#123;</div><div class="line">    	   sChedulers = <span class="keyword">new</span> Schedulers();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> sChedulers;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  上面错误的单例代码段思路很简单：如果 sChedulers 为空那么我们就构造一个 Schedulers 对象就好了。假如时有两个线程 AB 同时进入 getSchedulers() 方法，它们按照如下方式开始执行：</p>
<p>  A | B<br>  — | —-<br>  (null == sChedulers) true |  &emsp;<br>  开始准备执行 sChedulers = new Schedulers() （仅仅是准备，并未开始） | (null == sChedulers) true</p>
<pre><code>&amp;emsp; | 执行 sChedulers = new Schedulers()
</code></pre><p>  执行 sChedulers = new Schedulers()  |   &emsp;<br>  很显然，new Schedulers() 被执行了两遍，这显然不是我们的初衷。</p>
</li>
<li><p>正确但性能堪忧<br>  既然这样，那么有的同学提出给方法加上 synchronized 关键字，synchronized 可以保证每次只有一个线程进入方法 getSchedulers() 。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> Scheduler sChedulers;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Scheduler <span class="title">getSchedulers</span><span class="params">()</span> </span>&#123;</div><div class="line">     <span class="keyword">if</span>(<span class="keyword">null</span> == sChedulers)&#123;</div><div class="line">          sChedulers = <span class="keyword">new</span> Schedulers();</div><div class="line">     &#125;</div><div class="line"> <span class="keyword">return</span> sChedulers;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  这样确实解决了问题，但 synchronized 关键字本身会导致繁琐的线程锁操作，同时假如时有两个线程 AB 尝试进入 getSchedulers() 那么它们就不得不排队，这样造成了性能上的问题。</p>
</li>
<li><p><font color="#FF0000">改进的一种正确写法，性能和代码量适中</font><br>  实际上我们希望的只是在 sChedulers 创建的时候只能有一个线程进入 getSchedulers() 方法，所以我们只需要对加锁的位置稍作改变：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> Scheduler sChedulers;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Scheduler <span class="title">getSchedulers</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span>(<span class="keyword">null</span> == sChedulers)&#123;</div><div class="line">       	<span class="keyword">synchronized</span> (RxUtils.class)&#123;</div><div class="line">           	<span class="keyword">if</span>(<span class="keyword">null</span> == sChedulers)&#123;</div><div class="line">                   sChedulers = <span class="keyword">new</span> Schedulers();</div><div class="line">           	&#125;    </div><div class="line">  	   	&#125;</div><div class="line"> 	&#125;</div><div class="line"><span class="keyword">return</span> sChedulers;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  到此问题已经解决了一大半，但是很遗憾上述代码依然没有达到我们的目的。问题出在 <code>sChedulers = new Schedulers();</code> 这里，这一句代码并不是一个原子操作，实际上我们可以把它拆成3行代码：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">memory = allocate();      <span class="comment">//1：分配对象的内存空间</span></div><div class="line">ctorInstance(memory);     <span class="comment">//2：初始化对象</span></div><div class="line">sChedulers = memory;      <span class="comment">//3：设置sChedulers指向刚分配的内存地址</span></div></pre></td></tr></table></figure>
<p>  在 JVM 的即时编译器中存在指令重排序的优化：1总是最先执行，但是2和3执行的先后顺序是不确定的，只有执行完3以后 <code>null == sChedulers</code> 才会为 false，如果按照132的执行顺序可能会出现问题，原因如下：</p>
<p>  A | B<br>  — | —-<br>  (null == sChedulers) true |  &emsp;<br>  memory = allocate() | (null == sChedulers) true<br>  sChedulers = memory （sChedulers仅分配了内存而未初始化）|  &emsp;<br>   &emsp; | (null == sChedulers) false<br>   &emsp; | return sChedulers</p>
<p>  解决这个问题的办法是为 <code>sChedulers</code> 加上 volatile 关键字。volatile 变量具备两种特性，其一是保证该变量对所有线程可见，这里的可见性指的是当一个线程修改了变量的值，那么新的值对于其他线程是可以立即获取的。其二 volatile 禁止了指令重排，也就是说保证指令按照123的顺序执行，至此完整的代码如下：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Scheduler sChedulers;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Scheduler <span class="title">getSchedulers</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(<span class="keyword">null</span> == sChedulers)&#123;</div><div class="line">    <span class="keyword">synchronized</span> (RxUtils.class)&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == sChedulers)&#123;</div><div class="line">             sChedulers = <span class="keyword">new</span> Schedulers();</div><div class="line">        &#125;    </div><div class="line">    &#125;</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">return</span> sChedulers;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>正确但浪费资源<br>  当然这样写</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> Scheduler sChedulers = <span class="keyword">new</span> Schedulers();</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Scheduler <span class="title">getSchedulers</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> sChedulers;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  可以达到单例目的，sChedulers = new Schedulers() 会在类初始化的时候执行，并且只执行一次。但是如果我们一次也没用过 sChedulers 这个对象的话这样会造成资源的浪费。</p>
</li>
<li><p><font color="#FF0000">内部类写法（性能最优，写法繁琐）</font><br>  如果你不想使用 synchronized 关键字，还可以通过内部类的方式来写，先上代码：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InstanceHolder</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Scheduler sChedulers = <span class="keyword">new</span> Schedulers();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Scheduler <span class="title">getSchedulers</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> InstanceHolder.sChedulers;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  因为内部类 InstanceHolder 除了 getSchedulers() 以外没有别的方式可以访问到它，所以它只会在调用 getSchedulers() 方法以后才会被加载。整个方法不需要同步，因此没有性能损失。</p>
</li>
<li><p><font color="#FF0000">枚举写法（极简写法）</font><br>  最后可以使用枚举的方式来写，代码量极简</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SchedulerHolder &#123;</div><div class="line">    INSTANCE;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  通过 SchedulerHolder.INSTANCE 的方式就可以直接访问到单例的 INSTANCE 了，这也是一种选择。</p>
</li>
</ul>
<p>总之上述标红的方式都是值得尝试的单例写法，欢迎大家讨论。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/2016年-Github-成绩单/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/2016年-Github-成绩单/" itemprop="url">2016年 Github 成绩单</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T08:59:45+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>年末看了一下自己2016年Github成绩单，在今年的业余时间里面：</p>
<ul>
<li>总共修改代码12万行</li>
<li>新增代码9万4千行</li>
<li>删除代码2万7千行</li>
</ul>
<p>记得年初的时候和大象吃完午饭以后在路边侃大山的时候就说今年的目标之一就是要多多在Github上写写代码，现在算是完成了这个目标吧，希望2017年继续努力。<br><img src="http://ww1.sinaimg.cn/large/a79b04ecgy1fcpx1mx4szj215u0dsmz9" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/一种全新的图片格式-WebP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/一种全新的图片格式-WebP/" itemprop="url">一种全新的图片格式 WebP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T08:59:01+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><h4 id="WebP-是什么："><a href="#WebP-是什么：" class="headerlink" title="WebP 是什么："></a>WebP 是什么：</h4><p>  体积越来越小，画质越来越好一直都是我们对图片文件的追求， WebP 便是在这种追求趋势下由 Google 在前几年提出的一种图片压缩存储方式，项目主页是：<a href="https://developers.google.com/speed/webp/" target="_blank" rel="external">Google WebP</a><br>  同样的 Google 在 2014 开发者大会上的介绍了 WebP 的一些使用：</p>
<p>  <a href="https://www.google.com/events/io/io14videos/ff8ee9de-8af6-e311-903f-00155d5066d7" target="_blank" rel="external"><img src="http://ww1.sinaimg.cn/mw690/a79b04ecgy1feblgxova5j20fs0eiae6.jpg" width="300">    <a href="https://www.google.com/events/io/io14videos/43f7d45d-cab9-e311-b297-00155d5066d7" target="_blank" rel="external"><img src="http://ww1.sinaimg.cn/mw690/a79b04ecgy1feblt3g9idj20fs0eoaei.jpg" width="300"></a></a></p>
</li>
<li><h4 id="WebP-优势是什么："><a href="#WebP-优势是什么：" class="headerlink" title="WebP 优势是什么："></a>WebP 优势是什么：</h4><ul>
<li><h5 id="在肉眼画质几乎不变的情况下，体积大幅度减小"><a href="#在肉眼画质几乎不变的情况下，体积大幅度减小" class="headerlink" title="在肉眼画质几乎不变的情况下，体积大幅度减小"></a>在肉眼画质几乎不变的情况下，体积大幅度减小</h5>  相比于PNG，无损压缩的WebP的体积会小26%，在压缩率相同的情况下，有损压缩的 WebP 比 JPG 小 25%～34%。只需要22%额外的体积，无损压缩的 WebP 便可支持透明度（ alpha 通道）。在可以接受有损 RGB 压缩的情况下，有损 WebP 同样支持透明度，这一般会比 PNG 小3倍。更加直观的测试可以看这里： <a href="https://isparta.github.io/compare-webp/index.html#12345" target="_blank" rel="external">腾讯设计团队 WebP 测试网页</a>。<a href="http://labs.qiang.it/wen/webp/compare.html" target="_blank" rel="external">压缩效果测试</a><br>   科技博客 Gig‍‍‍aOM 曾报道：YouTube 的视频略缩图采用 WebP 格式后，网页加载速度提升了 10%；谷歌的 Chrome 网上应用商店采用 WebP 格式图片后，每天可以节省几 TB 的带宽，页面平均加载时间大约减少 1/3；Google+ 移动应用采用 WebP 图片格式后，每天节省了 50TB 数据存储空间。</li>
<li><h5 id="加载速度大幅增加："><a href="#加载速度大幅增加：" class="headerlink" title="加载速度大幅增加："></a>加载速度大幅增加：</h5>   <font color="#FF0000">在移动端上 WebP 的解码用平均高于 PNG 5倍左右</font>（数据源于<a href="https://isux.tencent.com/introduction-of-webp.html" target="_blank" rel="external">腾讯设计团队</a>）。但由于差异在毫秒以内，并且移动端加载图片主要耗时在网络图片拉取上，所以实际用户体验来看 WebP 的加载速度要明显高于 PNG。更加直观的测试我们可以看这里<a href="http://labs.qiang.it/wen/webp/test.html" target="_blank" rel="external">凹凸实验室</a>.</li>
</ul>
</li>
<li><h4 id="WebP-兼容性："><a href="#WebP-兼容性：" class="headerlink" title="WebP 兼容性："></a>WebP 兼容性：</h4>  Google 旗下几乎所有产品都使用 WebP 作为其图片储存方式，国内 QQ、微信等也早就使用 WebP 进行相关产品开发。Android4.0 以上提供的原生支持（无损、透明度支持需要 Android 4.2.1 以上），其他版本以及 iOS 都可以直接使用官方提供的解析库（ <a href="https://github.com/alexey-pelykh/webp-android-backport" target="_blank" rel="external">Android</a> 、<a href="https://github.com/carsonmcdonald/WebP-iOS-example" target="_blank" rel="external">iOS</a> ）。当然在 Android 上我们还有更多的选择，比如：<a href="https://github.com/facebook/fresco/" target="_blank" rel="external">Fresco</a>。以下是 Google 提供的支持表格。<br>  <a href="https://developer.android.com/guide/topics/media/media-formats.html" target="_blank" rel="external"><img src="http://ww1.sinaimg.cn/large/a79b04ecgy1fed16r6gchj21g80famyv.jpg"></a></li>
<li><h4 id="WebP-性能："><a href="#WebP-性能：" class="headerlink" title="WebP 性能："></a>WebP 性能：</h4><p>  因为关于 WebP 的性能讨论在网上已经有大量可寻的证据和较为固定的结论，所以这里直接引用 <a href="https://isux.tencent.com/introduction-of-webp.html" target="_blank" rel="external">腾讯设计团队</a> 在 Android QQ 上测试的结论：</p>
<blockquote>
<p>可见除了 WebP 在解码时间与 PNG 有较明显差异（毫秒级别）之外，总体使用体验和 PNG 基本无差异（内存、 FPS 等）– <a href="https://isux.tencent.com/introduction-of-webp.html" target="_blank" rel="external">腾讯设计团队</a></p>
</blockquote>
</li>
<li><h4 id="WebP-压缩参数以及使用："><a href="#WebP-压缩参数以及使用：" class="headerlink" title="WebP 压缩参数以及使用："></a>WebP 压缩参数以及使用：</h4><p>  依据<a href="https://isux.tencent.com/introduction-of-webp.html" target="_blank" rel="external">腾讯设计团队</a>的调研结果。压缩参数说明：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-lossless：无损压缩</div><div class="line">-q：压缩质量，值越大越图片质量越好</div><div class="line">-m：压缩方式，值越大则图片质量越好，体积越小，但是耗时较长</div></pre></td></tr></table></figure>
<p>  可以发现，无损压缩表现很稳定，压缩质量越高，压缩效果也越好。而有损压缩在压缩质量设置为 75 以上之后，压缩效果反而减弱，甚至压缩后的图片体积会大于压缩前的体积。所以得出以下结论：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">选择无损压缩时，“-lossless -q 100” 是最佳方案</div><div class="line">选择有损压缩时，“-q 75”是最佳方案（图片质量与体积大小达到均衡）</div><div class="line">无论何种压缩参数，加上“-m 6”都能使得输出的 WebP 图片进一步减少体积，量级是1%~2%，但是会增加耗时</div></pre></td></tr></table></figure>
<p>  使用<a href="https://github.com/iSparta/iSparta" target="_blank" rel="external">iSparta</a>可以方便的对图片进行转换。</p>
</li>
<li><h4 id="动态-WebP（Animated-WebP）"><a href="#动态-WebP（Animated-WebP）" class="headerlink" title="动态 WebP（Animated WebP）"></a>动态 WebP（Animated WebP）</h4><p>  目前 Animated WebP 支持将 GIF 直接转换成 Animated WebP，或者将多张 WebP 图片组合成 Animated WebP，具有以下优势：</p>
<ul>
<li>支持有损和无损压缩，并且可以合并有损和无损图片帧</li>
<li>体积更小，GIF 转成有损 Animated WebP 后可以减小 64% 的体积，转成无损可以节省 19% 的体积</li>
<li>颜色更丰富，支持 24-bit 的 RGB 颜色以及 8-bit 的 Alpha 透明通道（而 GIF 只支持 8-bit RGB 颜色以及 1-bit 的透明）</li>
<li><p>添加了关键帧、metadata 等数据<br>但是在国外某人提供的<a href="http://littlesvr.ca/apng/gif_apng_webp.html" target="_blank" rel="external">测试网站</a>中我们发现，在很多情况下  Animated WebP 的压缩情况并不是那么优秀，甚至出现了<a href="http://littlesvr.ca/apng/gif_apng_webp1.html" target="_blank" rel="external">画质下降同时体积反而增大的情况</a>。同样<a href="https://isux.tencent.com/introduction-of-webp.html" target="_blank" rel="external">腾讯设计团队</a>也在他们的调研中写道：</p>
<blockquote>
<p>根据自己实际的测试，发现 Animated WebP 的压缩效果较不稳定，在默认压缩配置下达不到 Google 官方提供的示例效果。</p>
</blockquote>
<p>不过在特定情况下， Animated WebP 有着自己的优势，比如这里<a href="http://www.jianshu.com/p/8dc745523e03?utm_source=itdadao&amp;utm_medium=referral" target="_blank" rel="external">视频直播之webp礼物解决方案</a> 为我们提供了一种思路。</p>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/Android-AndResGuard-资源混淆/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/Android-AndResGuard-资源混淆/" itemprop="url">Android AndResGuard 资源混淆</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T08:58:10+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>做过 Android 开发的人都知道，Android App 很容易被反编译，这里安利一个非常实用的开源可视化的跨平台 Apk 分析工具： <a href="https://github.com/linchaolong/ApkToolPlus" target="_blank" rel="external">ApkToolPlus</a> ，使用它可以傻瓜化，一键对 Apk 进行反编译等操作。这里以我的开源作品 <a href="https://github.com/ayaseruri/vscam" target="_blank" rel="external">VSCAM</a> 为例，资源部分反编译以后如下图所示，可以看到里面所有的路径、资源都明明白白的展现在大家面前：<br><img src="http://ww1.sinaimg.cn/large/a79b04ecgy1fcop2kvx82j216s0o8te1" width="650/"></p>
<ul>
<li><h3 id="1、为什么要做资源混淆："><a href="#1、为什么要做资源混淆：" class="headerlink" title="1、为什么要做资源混淆："></a>1、为什么要做资源混淆：</h3><ul>
<li>降低代码破解后的可读性，防止破解者通过资源文件路径、名称猜测到资源具体使用方式，从而进行修改替换</li>
<li>去除未使用资源文件，减少 Apk 体积</li>
</ul>
</li>
<li><h3 id="2、资源混淆目的："><a href="#2、资源混淆目的：" class="headerlink" title="2、资源混淆目的："></a>2、资源混淆目的：</h3>  简单的讲就是将 res/drawable/icon.png 变成 res/drawable/a.png，举个例子<br>源代码为：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mLoginIc.setImageURI(Uri.parse(<span class="string">"res:///"</span> + R.mipmap.ic_login));</div></pre></td></tr></table></figure>
</li>
</ul>
<p>资源混淆后变为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mLoginIc.setImageURI(Uri.parse(<span class="string">"res:///"</span> + R.mipmap.a));</div></pre></td></tr></table></figure></p>
<p>甚至你可以连路径都混淆，变为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mLoginIc.setImageURI(Uri.parse(<span class="string">"res:///"</span> + R.b.a));</div></pre></td></tr></table></figure></p>
<ul>
<li><h4 id="3、资源混淆方案："><a href="#3、资源混淆方案：" class="headerlink" title="3、资源混淆方案："></a>3、资源混淆方案：</h4><ul>
<li><h5 id="Proguard-："><a href="#Proguard-：" class="headerlink" title="Proguard ："></a>Proguard ：</h5>  Android 代码可以通过 Proguard 进行混淆，那么我们可以通过相同的思路对资源进行混淆，具体做法就是在代码编辑阶段修改代码中资源引用名称和实际资源文件名已达到资源混淆的目的。当然这种做法需要依赖编译过程，而且不能混淆路径。</li>
<li><h5 id="修改-resources-arsc-："><a href="#修改-resources-arsc-：" class="headerlink" title="修改 resources.arsc ："></a>修改 resources.arsc ：</h5>  根据Android的编译流程，所有资源ID已经被编译成32位int值。这说明我们并不需要去修改xml与java，因为在编译过程已经被R.java所替换，Android 通过 resources.arsc 来查找所需要的资源，如下图所示：<br>  <img src="http://ww1.sinaimg.cn/large/a79b04ecgy1fcosn1ddt4j20k50idael" width="550/"><br>  我们直接修改 resources.arsc 的二进制数据，不改变打包流程，只要在生成resources.arsc之后修改它，同时重命名资源文件，可以混淆路径。<ul>
<li>编译过程中修改 resources.arsc ，这个需要依赖编译过程</li>
<li>打包以后修改 resources.arsc ，自由，使用方便，目前这个方案是最优的</li>
</ul>
</li>
</ul>
</li>
<li><h4 id="4、技术实现："><a href="#4、技术实现：" class="headerlink" title="4、技术实现："></a>4、技术实现：</h4><p>  目前资源混淆有两种方案：<a href="http://tech.meituan.com/mt-android-resource-obfuscation.html" target="_blank" rel="external">美团方案</a> 和微信开源的 <a href="https://github.com/shwenzhang/AndResGuard" target="_blank" rel="external">AndResGuard</a> 方案。</p>
<p>  <strong> 美团方案 </strong>： AAPT(Andoird Asset Packaging Tool)是编译过程中用于打包资源文件的工具，AAPT这个工具在打包过程中主要做了下列工作：</p>
<ul>
<li>把”assets”和”res/raw”目录下的所有资源进行打包（会根据不同的文件后缀选择压缩或不压缩），而”res/“目录下的其他资源进行编译或者其他处理（具体处理方式视文件后缀不同而不同，例如：”.xml”会编译成二进制文件，”.png”文件会进行优化等等）后才进行打包；</li>
<li>会对除了 assets 资源之外所有的资源赋予一个资源ID常量，并且会生成一个资源索引表 resources.arsc ；</li>
<li>编译 AndroidManifest.xml 成二进制的XML文件；</li>
<li>把上面3个步骤中生成结果保存在一个 *.ap_ 文件，并把各个资源ID常量定义在一个 R.java 中；<br>上述过程的图示如下：<br><img src="http://ww1.sinaimg.cn/mw690/a79b04ecgy1fee60994nyj20p20c240g.jpg"><br>通过阅读AAPT编译资源的代码，我们发现修改AAPT在处理资源文件相关的源码是能够做到资源文件名的替换，核心代码在 Resource.cpp 中的 makeFileResources() 代码片段：</li>
</ul>
<p><strong> AndResGuard </strong>： 通过解析并修改 resources.arsc 的二进制文件，对打包好的 APK 进行处理。</p>
<ul>
<li><h5 id="R-java-文件内容："><a href="#R-java-文件内容：" class="headerlink" title="R.java 文件内容："></a>R.java 文件内容：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">string</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LOADING=<span class="number">0x7f08001d</span>;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> abc_action_bar_home_description=<span class="number">0x7f080000</span>;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> abc_action_bar_home_description_format=<span class="number">0x7f080001</span>;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> abc_action_bar_home_subtitle_description_format=<span class="number">0x7f080002</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到每个资源文件在R中都是一个class，每个资源项名称都分配了一个id，id值是一个四字节无符号整数，格式是这样的：<br><strong> <code>0xpptteeee</code> </strong>（p代表的是package，t代表的是type，e代表的是entry），最高字节代表Package ID，次高字节代表Type ID，后面两个字节代表Entry ID。<br><strong> <code>Package ID</code> </strong> 相当于是一个命名空间，限定资源的来源。Android系统当前定义了两个资源命令空间，其中一个系统资源命令空间，它的Package ID等于0x01，另外一个是应用程序资源命令空间，它的Package ID等于0x7f。所有位于[0x01, 0x7f]之间的Package ID都是合法的，而在这个范围之外的都是非法的Package ID。前面提到的系统资源包package-export.apk的Package ID就等于0x01，而我们在应用程序中定义的资源的Package ID的值都等于0x7f，这一点可以通过生成的R.java文件来验证。<br><strong> <code>Type ID</code> </strong> 是指资源的类型ID。资源的类型有animator、anim、color、drawable、layout、menu、raw、string和xml等等若干种，每一种都会被赋予一个ID。<br><strong> <code>Entry ID</code></strong> 是指每一个资源在其所属的资源类型中所出现的次序。注意，不同类型的资源的 Entry ID 有可能是相同的，但是由于它们的类型不同，我们仍然可以通过其资源ID来区别开来。</p>
</li>
<li><h5 id="resources-arsc-文件结构："><a href="#resources-arsc-文件结构：" class="headerlink" title="resources.arsc 文件结构："></a>resources.arsc 文件结构：</h5><p>  <img src="http://ww1.sinaimg.cn/large/a79b04ecgy1fcoxw5mv0jj21dw1betfq" alt=""><br>  详细结构如上图，这里选取重点的几个部分做简单交代：<br>  首先贴上一段 <code>string.xml</code> 代码段备用：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"app_name"</span>&gt;</span>VSCAM<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"data_error"</span>&gt;</span>服务器返回数据错误<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"net_error"</span>&gt;</span>网络开了一个小差<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"already_end"</span>&gt;</span>已经到底啦<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li><h6 id="Global-String-Pool（全局字符串池）"><a href="#Global-String-Pool（全局字符串池）" class="headerlink" title="Global String Pool（全局字符串池）"></a>Global String Pool（全局字符串池）</h6><pre><code>所有的资源文件的路径名，以及资源文件中所定义的资源的值都会放在这里，而且字符串可以复用来减少 Apk 的体积。例如上段代码的 VSCAM 、 服务器返回数据错误 、 已经到底啦 。
</code></pre></li>
<li><h6 id="类型字符串池和资源项名称字符串池"><a href="#类型字符串池和资源项名称字符串池" class="headerlink" title="类型字符串池和资源项名称字符串池"></a>类型字符串池和资源项名称字符串池</h6><p>   类型字符串池和资源项名称字符串池结构和全局字符串池是一样的。类型字符串池中存储的是所有类型相关的字符串，比如 attr、drawable、layout 这些，而资源项名称字符串池中存储的是应用所有资源文件中的资源项名称相关的字符串，比如上段代码中的app_name、data_error、net_error。</p>
</li>
<li><h6 id="类型规范数据块（Type-Spec）"><a href="#类型规范数据块（Type-Spec）" class="headerlink" title="类型规范数据块（Type Spec）"></a>类型规范数据块（Type Spec）</h6><p>   Android 应用程序资源的组织方式有18个维度，每一个维度都代表一个配置信息，从而可以使得应用程序能够根据设备的当前配置信息来找到最匹配的资源来展现在UI上，从而提高用户体验。也就是说，每一个资源类，都会有一个配置列表，配置着这个资源类的不同维度的信息，那么 Type Spec就是这个资源类的代表。</p>
</li>
<li><h6 id="Config-List"><a href="#Config-List" class="headerlink" title="Config List"></a>Config List</h6><p>  上面讲到每个Type Spec是对一个类型的描述，每个类型会有多个维度，每个维度对应一个Config List。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="资源查找过程"><a href="#资源查找过程" class="headerlink" title="资源查找过程"></a>资源查找过程</h5><ul>
<li><code>Package ID</code> 找到相应的 Package</li>
<li><code>Type ID</code> 找到相应的 Type Spec</li>
<li><code>Entry ID</code> 找到相应资源项名称在 Config list</li>
<li><code>Config list</code> 找到资源类型ID 和 实际资源值在 Global String Pool 中的偏移<br>如果需要更详细的过程 大家可以参考文章 <a href="http://www.cnblogs.com/feng9exe/p/5676802.html" target="_blank" rel="external">手把手教你解析Resources.arsc</a> 用实际的二进制文件进行分析，讲解的很详细，不过略显复杂，需要花时间整理思路。</li>
</ul>
</li>
<li><h5 id="AndResGuard-所做的工作："><a href="#AndResGuard-所做的工作：" class="headerlink" title="AndResGuard 所做的工作："></a>AndResGuard 所做的工作：</h5><p>  操作位置 | 操作<br>  ———- | ———-<br>  Global String Pool | 我们需要把文件指向路径改变，例如 <code>res/layout/test.xml</code> ,改为<code>res/layout/a.xml</code><br>  资源的文件名 | 需要将资源的文件名改为对应上行，即将 test.xml 重命名为 a.xml<br>  资源项名称字符串池 | 旧的名称部分全部废弃，替换成所有我们混淆方案中用到的字符。由于大家都重复使用[a-z0-9], specsname 的总数量会大大减少。<br>  entry中指向的资源项名称中的id | 例如原本test.xml它指向资源项名称中的第十项，我们需要用混淆后的a项的位置改写。<br>  table chunk的大小 | 修改table chunk的最后大小</p>
</li>
<li><h4 id="实际测试："><a href="#实际测试：" class="headerlink" title="实际测试："></a>实际测试：</h4><p>  具体使用方法在GitHub上<a href="https://github.com/shwenzhang/AndResGuard/" target="_blank" rel="external">AndResGuard</a>已经写的很清楚了，我以<a href="https://github.com/ayaseruri/vscam" target="_blank" rel="external">VSCAM</a>为例进行测试。<br>  测试配置如下：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resproguard</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">issue</span> <span class="attr">id</span>=<span class="string">"property"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">seventzip</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">metaname</span> <span class="attr">value</span>=<span class="string">"META-INF"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">keeproot</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">issue</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">issue</span> <span class="attr">id</span>=<span class="string">"whitelist"</span> <span class="attr">isactive</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">issue</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">issue</span> <span class="attr">id</span>=<span class="string">"keepmapping"</span> <span class="attr">isactive</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">value</span>=<span class="string">"&#123;your_mapping_path&#125;"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">issue</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">issue</span> <span class="attr">id</span>=<span class="string">"compress"</span> <span class="attr">isactive</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">value</span>=<span class="string">"*.png"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">value</span>=<span class="string">"*.jpg"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">value</span>=<span class="string">"*.jpeg"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">value</span>=<span class="string">"*.gif"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">value</span>=<span class="string">"resources.arsc"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">issue</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">issue</span> <span class="attr">id</span>=<span class="string">"sign"</span> <span class="attr">isactive</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">value</span>=<span class="string">"/Users/wufeiyang/Downloads/release.keystore"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">storepass</span> <span class="attr">value</span>=<span class="string">"testres"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">keypass</span> <span class="attr">value</span>=<span class="string">"testres"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">alias</span> <span class="attr">value</span>=<span class="string">"testres"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">issue</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">resproguard</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  结果如下：</p>
<ul>
<li><p>文件体积减少0.4 MB<br> <img src="http://ww1.sinaimg.cn/large/a79b04ecgy1fcp1khu6kgj216s0mqn1q" alt=""></p>
</li>
<li><p>直接解压资源混淆过的 Apk，发现资源文件的路径了名称都进行了混淆<br> <img src="http://ww1.sinaimg.cn/large/a79b04ecgy1fcp1t5wi2zj21ae11sncp" alt=""></p>
</li>
<li><p>反编译资源混淆过的 Apk，发现反编译成功还原了文件的路径，但是文件名称依然是混淆状态<br> <img src="http://ww1.sinaimg.cn/large/a79b04ecgy1fcp1xjtomuj21a6110dwp" alt=""></p>
</li>
</ul>
</li>
<li><h4 id="和-Tinker-配合使用"><a href="#和-Tinker-配合使用" class="headerlink" title="和 Tinker 配合使用"></a>和 Tinker 配合使用</h4><p>  Tinker是微信官方的Android热补丁解决方案，它支持动态下发代码、So库以及资源，让应用能够在<br>  不需要重新安装的情况下实现更新。Tinker 已经在Github上开源<a href="https://github.com/Tencent/tinker" target="_blank" rel="external">直达链接</a>。</p>
<p>  AndResGuard 和 Tinker 配合使用在 <a href="https://github.com/Tencent/tinker/wiki/Tinker-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E6%AF%8F%E6%AC%A1%E7%BC%96%E8%AF%91%E6%88%91%E5%BA%94%E8%AF%A5%E4%BF%9D%E7%95%99%E5%93%AA%E4%BA%9B%E6%96%87%E4%BB%B6%E5%A6%82%E4%BD%95%E5%85%BC%E5%AE%B9andresguard" target="_blank" rel="external">Tinker Github WIKI</a> 里面有说明</p>
<blockquote>
<p>正如sample中app/build.gradle，每个可能用到Tinker发布补丁的版本，需要在编译后保存以下几个文件：</p>
<ol>
<li>编译后生成的apk文件，即用来编译补丁的基础版本；</li>
<li>若使用proguard混淆，需要保持mapping.txt文件；</li>
<li>需要保留编译时的R.txt文件；</li>
<li>若你同时使用了资源混淆组件AndResGuard, 你也需要将混淆资源的resource_mapping.txt保留下来，同时将r/*也添加到res pattern中。具体我们可以参考build.gradle。<br>微信通过将补丁编译与Jenkins很好的结合起来，只需要点击一个按钮，即可方便的生成补丁包。</li>
</ol>
</blockquote>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://ayaseruri.net/2017/06/24/Android动态改变桌面图标/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ayaseruri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ayaseruri">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/Android动态改变桌面图标/" itemprop="url">Android动态改变桌面图标</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T08:54:36+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>农历新年即将到来，手机上各种App的图标也都默默的换上了新衣服，如何实现在不发版的情况下动态改变App桌面图标呢？关键点就在<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">activity-alias</span>&gt;</span></div><div class="line">PackageManager.setComponentEnabledSetting()；</div></pre></td></tr></table></figure></p>
<ul>
<li><p><code>&lt;activity-alias&gt;</code><br>  在Manifest中我们可以用<activity-alias>标签来为activity设置别名，一般使用示例如下：</activity-alias></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="tag">&lt;<span class="name">activity-alias</span> <span class="attr">android:enabled</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]</span></div><div class="line">     <span class="attr">android:exported</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"]    </div><div class="line">     <span class="attr">android:icon</span>=<span class="string">"drawable resource"</span></div><div class="line">     <span class="attr">android:label</span>=<span class="string">"string resource"</span></div><div class="line">     <span class="attr">android:name</span>=<span class="string">"string"</span>                  </div><div class="line">     <span class="attr">android:targetActivity</span>=<span class="string">"string"</span> &gt;</div><div class="line"> . . .</div><div class="line"><span class="tag">&lt;/<span class="name">activity-alias</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li><code>xml android:exported=[&quot;true&quot; | &quot;false&quot;]</code>:布尔类型,是否支持其他应用通过这个别名访问目标activity,默认值为true</li>
<li><code>xml android:name=&quot;string&quot;</code>:在 <code>xml &lt;activity&gt;</code> 标签中,name属性必须与对应activity文件的名字保持一致,而这里的别名可任意设置,保证唯一性即可</li>
<li><code>xml android:targetActivity=&quot;string&quot;</code>:指定别名能够启动的目标activity,注意,属性值一定要对应到<code>xml &lt;activity&gt;</code> 标签中的name属性,并且该 <code>xml &lt;activity&gt;</code> 标签一定要位于 <code>xml &lt;activity-alias&gt;</code> 标签前面</li>
</ul>
</li>
<li><p><code>java PackageManager.setComponentEnabledSetting()</code><br>用于负责在Java代码里面动态开启或者关闭<activity-alias>标签别名，一般使用示例如下：</activity-alias></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">PackageManager pm = getPackageManager();</div><div class="line">pm.setComponentEnabledSetting(getComponentName(),</div><div class="line">        PackageManager.COMPONENT_ENABLED_STATE_DISABLED, PackageManager.DONT_KILL_APP);</div><div class="line">或者</div><div class="line">pm.setComponentEnabledSetting(<span class="keyword">new</span> ComponentName(<span class="keyword">this</span>, <span class="string">"AliasName"</span>),</div><div class="line">        PackageManager.COMPONENT_ENABLED_STATE_ENABLED, PackageManager.DONT_KILL_APP);</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ww1.sinaimg.cn/large/a79b04ecgy1fgw5110v59j21k91k9u0x.jpg"
               alt="Ayaseruri" />
          <p class="site-author-name" itemprop="name">Ayaseruri</p>
           
              <p class="site-description motion-element" itemprop="description">一个少年，想要拥抱这宇宙的闪耀并创造奇迹。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ayaseruri/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/ayaseruri233" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://vscam.co/#!u/ayaseruri" target="_blank" title="Vscam">
                  
                    <i class="fa fa-fw fa-camera"></i>
                  
                  Vscam
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ayaseruri</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io"> Hexo </a><a class="theme-link">、</a><a class="theme-link" href="https://pages.coding.me"> Coding Pages </a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
